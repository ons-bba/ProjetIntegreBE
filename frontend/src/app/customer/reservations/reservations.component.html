<div class="reservations-container">
    <h2>Reservations Management</h2>
  
    <!-- Filters -->
    <div class="filters">
      <mat-form-field appearance="fill">
        <mat-label>Search by name</mat-label>
        <input matInput [(ngModel)]="searchQuery" (ngModelChange)="applyFilters()" placeholder="Search by customer, service, bundle, or status">
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Status</mat-label>
        <mat-select [(ngModel)]="filters.status" (ngModelChange)="applyFilters()">
          <mat-option value="">All Statuses</mat-option>
          <mat-option value="Pending">Pending</mat-option>
          <mat-option value="Completed">Completed</mat-option>
          <mat-option value="Cancelled">Cancelled</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Start Date</mat-label>
        <input matInput [matDatepicker]="startPicker" [(ngModel)]="filters.startDate" (ngModelChange)="onStartDateChange()">
        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>End Date</mat-label>
        <input matInput [matDatepicker]="endPicker" [(ngModel)]="filters.endDate" (ngModelChange)="onEndDateChange()" [matDatepickerFilter]="endDateFilter">
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>
    </div>
  
    <!-- Reservations List -->
    <div class="reservations-grid">
      <div class="reservation-card" *ngFor="let reservation of filteredReservations">
        <div class="reservation-image">
          <img *ngIf="reservation.qrCode" [src]="reservation.qrCode" alt="QR Code" (error)="onQRCodeError(reservation)">
          <div *ngIf="!reservation.qrCode" class="qr-placeholder">
            QR Code Not Available
          </div>
        </div>
        <div class="reservation-info">
          <h3>{{ getCustomerName(reservation.customerId) }}</h3>
          <p><strong>Service:</strong> {{ getServiceName(reservation.serviceId) }}</p>
          <p><strong>Bundle:</strong> {{ getBundleName(reservation.bundleId) }}</p>
          <p><strong>Status:</strong> {{ reservation.status }}</p>
          <p><strong>Booking Date:</strong> {{ reservation.bookingDate | date:'dd/MM/yyyy' }}</p>
          <p *ngIf="reservation.completionDate"><strong>Completion Date:</strong> {{ reservation.completionDate | date:'dd/MM/yyyy' }}</p>
          <p><strong>Total Cost:</strong> {{ reservation.totalCost | currency:'TND':'symbol':'1.3-3' }}</p>
          <p *ngIf="reservation.notes"><strong>Notes:</strong> {{ reservation.notes }}</p>
        </div>
        <div class="reservation-actions">
          <button mat-raised-button class="action-button cancel-button" [disabled]="reservation.status !== 'Pending' || !canCancelReservation(reservation.bookingDate)" (click)="cancelReservation(reservation._id, reservation.bookingDate)">
            Cancel
          </button>
          <button mat-raised-button class="action-button download-button" (click)="downloadQRCode(reservation.qrCode, reservation._id)">
            <mat-icon>qr_code</mat-icon> QR Code
          </button>
        </div>
      </div>
    </div>
  </div>